{% load staticfiles %}
{% load zip %}
<!DOCTYPE html>

<html lang="en">
<head>
  <title>Udghos</title>
  <link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'><link href='https://fonts.googleapis.com/css?family=Signika' rel='stylesheet' type='text/css'>

  <link href='https://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato">
  <link href="{% static 'css/styles.css' %}" rel="stylesheet">

  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">

  <link href="{% static 'css/mystatic.css' %}" rel="stylesheet">
  <link href="{% static 'css/mobile.css' %}" rel="stylesheet">

    <script>
    function submitPost() {
        // first collect tags
        var selected = document.getElementsByClassName('selected-tags');
        var tagids =[];
        for(var x=0;x<selected.length;x++) {
            tagids.push(selected[x].getAttribute('id').replace('selected-', ''))
        }
        // now check if description is empty
        var desc = $('textarea[name=content]').val();
        if (desc.trim() == '') {
            $('#description-warning').show();
            return false;
        }
        if(tagids.length==0) {
            $('#tags-warning').show();
            return false;
        }
        var inputelem = document.createElement('input');
        inputelem.setAttribute("type", "hidden");
        inputelem.setAttribute("name", "tagids");
        inputelem.setAttribute("value", tagids.toString());
        var form = document.getElementById("thread-form");
        form.appendChild(inputelem);
    }
    </script>

    <style>
        .alert-danger {
            background-color:none;
            color:red;
            font-size:0.9em;
        }
        body{
        font-family: 'Varela Round', sans-serif;
        padding:0;
        margin:0;
        width:100%;
        min-height:500px;
        }

    </style>
</head>

<body>
<script>
  function fbs_click() {u="www.udghos.com/haha";t=document.title;window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(u)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');return false;}
  </script>

  <nav id="navcolor" class="navbar navbar-inverse navbar-mathi">
      <div class="container">
        <div class="navbar-header">
          <a id="navhead" class="navbar-brand" href="/complain/login/">
            <img class="udghos-logo" src="/static/img/navbarlogo.png" width="30" height="30">
          </a>
        </div>
        
        {% if authenticated %}
          <ul id="headnav" class="nav navbar-nav navbar-right">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">
              <span class="navbar-name"> <i class="glyphicon glyphicon-triangle-bottom"></i></span>
              <img class="img-navbar" src="/media/{{profile_pic}}" width=30 height=30 /></a>
              <ul class="dropdown-menu dropdown-settings" role="menu">
                <li><a href="{% url 'profile' user.id %}">Profile</a></li>
                <li><a href="#">Settings</a></li>
                <li><a href="{% url 'logout' %}">Logout</a></li>
            </ul>
            <form class="navbar-form navbar-right form-group-navbar" role="search" onsubmit="return search()">
              <div class="form-group ">
                <div id="search-bar" class="inner-addon right-addon nav-search">
                  <i class="glyphicon glyphicon-search"></i>
                  <input type="text" id="searchquery" placeholder="Search" class="form-control form-control-navbar" />
                </div>
              </div>
            </form>
            <div class="dropdown">
                <ul class="gly-bell nav navbar-nav dropdown-toggle" id="dNotifications" role="button" data-toggle="dropdown">
                <li><i class="glyphicon glyphicon-bell"></i>
                {% if notifications %}
                <div class="notification-count">
                </div>
                {% endif %}
              </li></ul>
              <ul class="dropdown-menu notifications" role="menu" aria-labelledby="dNotifications">
                <div class="notification-heading"><h5 class="notification-title">Notifications</h5>
                  <div class="mark-read">
                    <a class="notification-title pull-right" href="javascript:void()" onclick="mark_read()">Mark as Read</a>
                  </div>
                </div>
                <div class="notifications-wrapper">
                  {% if notifications %}
                  {% else %}
                  <a class="content" href="#">
                    <div class="single-notification">
                    &nbsp; No new notifications
                    </div>
                  </a>
                  {% endif %}
                  {% for notif in notifications %}
                  <a class="content" href="/thread/{{notif.thread}}/">
                    <div class="single-notification">
                      <div class="stimg-notification">
                            <img class="img-circle" src="/media/{{notif.by_image}}" width=50 height=50/>
                      </div>
                      <p class="notification-title">
                        {% ifequal notif.type "comment" %}
                        Comment on your thread by {{notif.by}}
                        {% endifequal %}
                        {% ifequal notif.type "support" %}
                          Support on your thread by {{notif.by}}
                        {% endifequal %}
                        {% ifequal notif.type "downvote" %}
                          Downvote on your thread by {{notif.by}}
                        {% endifequal %}
                        <div class="notification-info">
                        About
                      </div>
                      </p>
                    </div>
                  </a>
                  {% endfor %}
                </div>
              </ul>
            </div>
          </ul>
            {% else %}
            
            <ul class="nav navhead-nav nav-unauth">
              <li class="icon-login"><a href="/about/">About</a></li>
            </ul> 
            {% endif %}        
      </div>
  </nav>



  <div class="container">
    <div class="row">
      <div class="col-md-2">
      
      </div>
      <div class="col-md-8">
        <div class="post-concern">
          <div class="modal-header my-color">
            <h4 class="modal-title title-concern" id="myModalLabel">Post Your View</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
            </div>
            <form method="post" id="thread-form" action="{% url 'post' %}" onsubmit="return submitPost()" class="form-horizontal" role="form" enctype="multipart/form-data">
              <label for="recipient-name" class="control-label">Title</label>
              <input type="text" name="title" class="form-control" id="recipient-name" placeholder="Title relevant to the description">

              {% csrf_token %}
              <input type="hidden" name="thread_type" value="complaint"/>
              <div class="form-group" style="padding:14px;">
                <label for="recipient-name" class="control-label">Description * <small id="description-warning" class="alert-danger" style="display:none"> Please provide a description of the issue!! </small></label>
                <textarea name="content" class="form-control" placeholder="Your queries here." oninput="$('#description-warning').hide()"></textarea>
                          
                <div class="form">
                            <label for="recipient-name" class="control-label">Who is to be addressed? <small id="targets-warning" class="alert-danger" style="display:none">Please provide at least 1 people/organization (max 2) </small></label><br>
                            <input type="text" class="form-control" placeholder="Who is to be addressed? (max 2)" id="targetbox"/>
                            <ul class="nav suggestions" id="targets-suggest-list" style="z-index:100;position:absolute;">
                            </ul>
                              <div id="targets-chosen">
                              </div>
                </div>

                <div class="form">
                  <label for="recipient-name" class="control-label">Tags * <small id="tags-warning" class="alert-danger" style="display:none">Please provide at least 1 tag(max 4) </small></label><br>
                  <input type="text" class="form-control" placeholder="Type in tag names (max 4)" id="tagbox"/>
                  <ul class="nav" id="tags-suggest-list" style="z-index:100;position:absolute;">
                  </ul>
                  <div id="tags-chosen">
                  </div>
                </div><br>
                <label for="recipient-name" class="control-label">Image(s)</label>
                <input type="file" name="images" multiple accept="image/*" />
              </div>
            
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button class="btn btn-my" type="submit">Post</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>


<div class="box-footer">
    <div class="container" > 
      <footer>
        <div class="footer-body">
          <p class="pull-right">
            <a href="#">Back to top</a>
          </p>
          <p>
            <a href="/about/">About</a>&middot;
            <a href="#">Privacy</a> &middot; 
            <a href="#">Terms & Conditions</a>
          </p>
          <p class="pull-right">
            <a href="https://facebook.com/udghos">Facebook</a>&middot;
            <a href="https://twitter.com/udghosnepal">Twitter</a>
          </p>
          <p class="copyright">
            &copy; 2016 Udghos.com
          </p>
        </div>
      </footer>
    </div>
  </div>

  </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    <script src="{% static 'js/myjs.js' %}"></script>
    <script src="{% static 'js/homepage.js' %}"></script>
    <script src="{% static 'js/functions.js'%}"></script>

    <script>
        var g_tags_selected = [];
    function getTags() {
        var query = $('#tagbox').val();
        if (query != '') {
            $.get('/complain/tags?query='+query, function(data) {
                renderTags(data);
            });
        }
    }

    $('#tagbox').on('input', getTags);

    function renderTags(data) {
        var tags = data.tags;
		var ul = document.getElementById('tags-suggest-list');
		ul.innerHTML="";
        for(var x in tags) {
            if (g_tags_selected.indexOf(tags[x].name) < 0 && g_tags_selected.length<4)
			    ul.innerHTML += '<li id="tag-'+tags[x].id+'" onclick="addTag(this)">'+tags[x].name+'</li>';
        }
    }
	
	function addTag(elem) {
        $('#tags-warning').hide();
        $('#tagbox').val('');
        $('#tags-suggest-list').empty();
        g_tags_selected.push(elem.innerHTML);
        var id = elem.getAttribute('id').replace('tag-', '');
		var tags_elem = document.getElementById('tags-chosen');	
		tags_elem.innerHTML+= '<span id="selected-'+id+'"class="btn selected-tags">' +elem.innerHTML+ '<button type="button" class="close my-close" id="close-tag"><span onclick="removeTag(\''+id+'\''+',\''+elem.innerHTML+'\')" aria-hidden="true">&times;</span></button></span>';
	}

    function removeTag(id, tagname) {
        var index = g_tags_selected.indexOf(tagname);
        g_tags_selected.splice(index, 1);
        $('#selected-'+id).remove();
    } 
    </script>


</html>
