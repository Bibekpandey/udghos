{% load staticfiles %}
{% load zip %}
<!DOCTYPE html>

<html lang="en">
<head>
  <title>Udghos</title>
  <link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'><link href='https://fonts.googleapis.com/css?family=Signika' rel='stylesheet' type='text/css'>

  <link href='https://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato">
  <link href='https://fonts.googleapis.com/css?family=Fjord+One' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Gentium+Basic|Raleway' rel='stylesheet' type='text/css'>
  <link href="{% static 'css/styles.css' %}" rel="stylesheet">

  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">

  <link href="{% static 'css/mystatic.css' %}" rel="stylesheet">
  <link href="{% static 'css/mobile.css' %}" rel="stylesheet">

    <script src="{% static 'js/functions.js'%}"></script>

    <script>
    function submitPost() {
        // first collect tags
        var selected = document.getElementsByClassName('selected-tags');
        var tagids =[];
        for(var x=0;x<selected.length;x++) {
            tagids.push(selected[x].getAttribute('id').replace('selected-', ''))
        }
        // now check if description is empty
        var desc = $('textarea[name=content]').val();
        if (desc.trim() == '') {
            $('#description-warning').show();
            return false;
        }
        if(tagids.length==0) {
            $('#tags-warning').show();
            return false;
        }
        var inputelem = document.createElement('input');
        inputelem.setAttribute("type", "hidden");
        inputelem.setAttribute("name", "tagids");
        inputelem.setAttribute("value", tagids.toString());
        var form = document.getElementById("thread-form");
        form.appendChild(inputelem);
    }
    </script>

    <style>
        .alert-danger {
            background-color:none;
            color:red;
            font-size:0.9em;
        }
    </style>
</head>

<body>
<script>
  function fbs_click() {u="www.udghos.com/haha";t=document.title;window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(u)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');return false;}
  </script>

  <nav id="navcolor" class="navbar navbar-inverse navbar-mathi">
      <div class="container">
        <div class="navbar-header">
          <a id="navhead" class="navbar-brand" href="/">Udghos</a>
        </div>
        
        {% if authenticated %}
          <ul id="headnav" class="nav navbar-nav navbar-right">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">
              <span class="navbar-name"> <i class="glyphicon glyphicon-triangle-bottom"></i></span>
              <img class="img-navbar" src="/media/{{profile_pic}}" width=30 height=30 /></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="{% url 'profile' user.id %}"><i class="glyphicon glyphicon-user">Profile</i></a></li>
                <li><a href="#"><i class="glyphicon glyphicon-wrench">Settings</i></a></li>
                <li><a href="{% url 'logout' %}"><i class="glyphicon glyphicon-erase">Logout</i></a></li>
            </ul>
            <form class="navbar-form navbar-right" role="search">
              <div class="form-group">
                <div id="search-bar" class="inner-addon right-addon nav-search">
                  <i class="glyphicon glyphicon-search"></i>
                  <input type="text" placeholder="Search" class="form-control form-control-navbar" />
                </div>
              </div>
            </form>
            <ul id="gly-bell" class="nav navbar-nav navbar-right">
              <li>
                <a href="#" title="Header" data-toggle="popover" data-trigger="focus" data-placement="bottom" data-content="Content">
                <i class="glyphicon glyphicon-bell"></i>
                <div class="notification-count">
                  5
                </div>
                </a>
              </li>
            </ul> 

            {% else %}
            
            <ul class="nav navhead-nav nav-unauth">
              <li class="icon-login"><a href="/complain/login" id="click-signup">LogIn/Sign Up</a></li>
              <li class="icon-login"><a href="/about/">About</a></li>
            </ul> 
            {% endif %}        
      </div>
  </nav>

  <div class="container">
    <div class="row">
      <div class="post-concern">
        <div class="modal-header my-color">
          <h4 class="modal-title title-concern" id="myModalLabel">Post Your View</h4><br>
        </div>
                    <div class="modal-body">
                      <div class="form-group">
                                            </div>
                      <form method="post" id="thread-form" action="{% url 'post' %}" onsubmit="return submitPost()" class="form-horizontal" role="form" enctype="multipart/form-data">
    <label for="recipient-name" class="control-label">Title</label>
                          <input type="text" name="title" class="form-control" id="recipient-name" placeholder="Title relevant to the description">

                        {% csrf_token %}
                        <input type="hidden" name="thread_type" value="complaint"/>
                        <div class="form-group" style="padding:14px;">
                          <label for="recipient-name" class="control-label">Description * <small id="description-warning" class="alert-danger" style="display:none"> Please provide a description of the issue!! </small></label>
                          <textarea name="content" class="form-control" placeholder="Your queries here." oninput="$('#description-warning').hide()"></textarea>
                          
                          <div class="form">
                            <label for="recipient-name" class="control-label">Tags * <small id="tags-warning" class="alert-danger" style="display:none">Please provide at least 1 tag(max 4) </small></label><br>
                            <input type="text" class="form-control" placeholder="Type in tag names (max 4)" id="tagbox"/>
                            <ul class="nav" id="tags-suggest-list" style="z-index:100;position:absolute;">
                            </ul>
                              <div id="tags-chosen">
                              </div>
                          </div><br><br>
                            <label for="recipient-name" class="control-label">Image(s)</label>
                          <input type="file" name="images" multiple accept="image/*" />
                        </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button class="btn btn-my" type="submit">Post</button>
                    </div>
                    </form>
                  </div>
                  </div>
            </div>
    </div>


<div class="box-footer">
    <div class="container" > 
      <footer>
        <div class="footer-body">
          <p class="pull-right">
            <a href="#">Back to top</a>
          </p>
          <p>
            <a href="#">About</a>&middot;
            <a href="#">Privacy</a> &middot; 
            <a href="#">Terms & Conditions</a>
          </p>
          <p class="pull-right">
            <form class="footer-form" role="search">
              <div class="form-group">
                <div id="search-bar" class="inner-addon right-addon nav-search">
                  <i class="glyphicon glyphicon-footer glyphicon-search"></i>
                  <input type="text" placeholder="Search" class="form-control form-control-footer" />
                </div>
              </div>
            </form>
          </p>
          <p class="pull-right">
            <a href="https://facebook.com/udghos">Facebook</a>&middot;
            <a href="https://twitter.com/udghosnepal">Twitter</a>
          </p>
          <p class="copyright">
            &copy; 2015 Udghos, Inc.
          </p>
        </div>
      </footer>
    </div>
  </div>

  </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    <script src="{% static 'js/myjs.js' %}"></script>
    <script src="{% static 'js/homepage.js' %}"></script>
    <script>
        var g_tags_selected = [];
    function getTags() {
        var query = $('#tagbox').val();
        if (query != '') {
            $.get('/complain/tags?query='+query, function(data) {
                renderTags(data);
            });
        }
    }

    $('#tagbox').on('input', getTags);

    function renderTags(data) {
        var tags = data.tags;
		var ul = document.getElementById('tags-suggest-list');
		ul.innerHTML="";
        for(var x in tags) {
            if (g_tags_selected.indexOf(tags[x].name) < 0 && g_tags_selected.length<4)
			    ul.innerHTML += '<li id="tag-'+tags[x].id+'" onclick="addTag(this)">'+tags[x].name+'</li>';
        }
    }
	
	function addTag(elem) {
        $('#tags-warning').hide();
        $('#tagbox').val('');
        $('#tags-suggest-list').empty();
        g_tags_selected.push(elem.innerHTML);
        var id = elem.getAttribute('id').replace('tag-', '');
		var tags_elem = document.getElementById('tags-chosen');	
		tags_elem.innerHTML+= '<span id="selected-'+id+'"class="btn selected-tags">' +elem.innerHTML+ '<button type="button" class="close my-close" id="close-tag"><span onclick="removeTag(\''+id+'\''+',\''+elem.innerHTML+'\')" aria-hidden="true">&times;</span></button></span>';
	}

    function removeTag(id, tagname) {
        var index = g_tags_selected.indexOf(tagname);
        g_tags_selected.splice(index, 1);
        $('#selected-'+id).remove();
    } 
    </script>


</html>
